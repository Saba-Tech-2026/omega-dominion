<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸš¢ Marine Shipping</title>

<style>
body {
    background:#0b1c2d;
    color:#fff;
    font-family: Arial, sans-serif;
    padding:20px;
}
.card {
    background:#142c44;
    padding:15px;
    border-radius:10px;
    margin-bottom:15px;
}
input, button {
    padding:8px;
    margin-top:5px;
    width:100%;
}
button {
    background:#4da6ff;
    border:none;
    font-weight:bold;
    cursor:pointer;
}
.error { color:#ff4d4d; }
.profit { color:#4dff88; font-size:18px; }
</style>
</head>

<body>

<h1>ğŸš¢ Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø­Ù† Ø§Ù„Ø¨Ø­Ø±ÙŠ</h1>

<div class="card">
    <h3>ğŸ“¦ Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø­Ù†Ø©</h3>
    <input id="origin" placeholder="Ù…ÙŠÙ†Ø§Ø¡ Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚">
    <input id="destination" placeholder="Ù…ÙŠÙ†Ø§Ø¡ Ø§Ù„ÙˆØµÙˆÙ„">
    <button onclick="createShipment()">Ø¥Ù†Ø´Ø§Ø¡</button>
    <div id="shipmentId"></div>
</div>

<div class="card">
    <h3>ğŸ“¡ ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø©</h3>
    <button onclick="trackShipment()">ØªØ­Ø¯ÙŠØ«</button>
    <div id="dashboard"></div>
</div>

<script>
const BASE_URL = "http://127.0.0.1:8080";
let currentShipment = null;

// ================= Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø­Ù†Ø© =================
async function createShipment() {
    const origin = document.getElementById("origin").value;
    const destination = document.getElementById("destination").value;

    if (!origin || !destination) {
        alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙŠÙ†Ø§Ø¡ÙŠÙ†");
        return;
    }

    try {
        const res = await fetch(`${BASE_URL}/api/marine/create`, {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ origin, destination })
        });

        if (!res.ok) throw new Error("ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´Ø­Ù†Ø©");

        const data = await res.json();
        currentShipment = data.shipment_id;

        document.getElementById("shipmentId").innerHTML =
            `âœ… Ø±Ù‚Ù… Ø§Ù„Ø´Ø­Ù†Ø©: <b>${currentShipment}</b>`;

    } catch (e) {
        document.getElementById("shipmentId").innerHTML =
            `<span class="error">âŒ ${e.message}</span>`;
    }
}

// ================= ØªØªØ¨Ø¹ Ø´Ø­Ù†Ø© =================
async function trackShipment() {
    if (!currentShipment) {
        alert("Ø£Ù†Ø´Ø¦ Ø´Ø­Ù†Ø© Ø£ÙˆÙ„Ø§Ù‹");
        return;
    }

    try {
        const res = await fetch(
            `${BASE_URL}/api/marine/track/${currentShipment}`
        );

        if (!res.ok) throw new Error("ÙØ´Ù„ Ø§Ù„ØªØªØ¨Ø¹");

        const d = await res.json();

        document.getElementById("dashboard").innerHTML = `
            <b>ğŸš¢ Ø±Ù‚Ù… Ø§Ù„Ø´Ø­Ù†Ø©:</b> ${d.system.shipment_id}<br>
            <b>ğŸ“¦ Ø§Ù„Ø­Ø§Ù„Ø©:</b> ${d.system.status}<br><br>

            <b>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹:</b> ${d.globe.position.join(", ")}<br>
            <b>ğŸ¯ Ø§Ù„ÙˆØ¬Ù‡Ø©:</b> ${d.globe.destination}<br>
            <b>â³ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</b> ${d.globe.eta_hours} Ø³Ø§Ø¹Ø©<br>
            <b>âš ï¸ Ø§Ù„Ù…Ø®Ø§Ø·Ø±:</b> ${d.globe.threat}<br><br>

            <span class="profit">
            ğŸ’° Ø§Ù„Ø±Ø¨Ø­: ${d.finance.trip_profit} ${d.finance.currency}
            </span><br>

            <b>ğŸ›ƒ Ø§Ù„ØªØ®Ù„ÙŠØµ:</b> ${d.customs.status}
        `;
    } catch (e) {
        document.getElementById("dashboard").innerHTML =
            `<span class="error">âŒ ${e.message}</span>`;
    }
}
</script>

</body>
</html>